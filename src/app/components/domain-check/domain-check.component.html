<div class="container my-3">

  <div class="container">
    <form [formGroup]="checkForm" (ngSubmit)="onSubmit()" class="row g-3">
      <h1 class="text-center mb-2 fw-bold">Website Quality Checker</h1>
      <div class="col-12">
        <label for="domain" class="form-label">Domain</label>
        <input id="domain" type="text" formControlName="domain" class="form-control"
          [class.is-invalid]="submitted && f['domain'].invalid" placeholder="example.com" />
        <div *ngIf="submitted && f['domain'].errors" class="invalid-feedback">
          <div *ngIf="f['domain'].errors?.['required']">Domain is required.</div>
          <div *ngIf="f['domain'].errors?.['pattern']">Enter a valid domain (example.com).</div>
          <div *ngIf="f['domain'].errors?.['invalidDomain']">Domain failed server validation.</div>
        </div>
      </div>

      <div class="col-12">
        <label for="name" class="form-label">Name</label>
        <input id="name" type="text" formControlName="name" class="form-control" placeholder="Name"
          [class.is-invalid]="submitted && f['name'].invalid" />
        <div *ngIf="submitted && f['name'].errors" class="invalid-feedback">Name required (min 2).</div>
      </div>

      <div class="col-12">
        <label for="phone" class="form-label">Phone</label>
        <input id="phone" type="tel" formControlName="phone" class="form-control" placeholder="+1 267 XXXX"
          [class.is-invalid]="submitted && f['phone'].invalid" />
        <div *ngIf="submitted && f['phone'].errors" class="invalid-feedback">Enter valid phone number.</div>
      </div>

      <div class="col-12 form-check">
        <input id="spam" type="checkbox" class="form-check-input" formControlName="spamProtection" />
        <label class="form-check-label" for="spam">I’m not a robot</label>
        <div *ngIf="submitted && f['spamProtection'].errors" class="invalid-feedback d-block">Please confirm.</div>
      </div>

      <div class="col-auto">
        <button type="submit" class="btn btn-primary" [disabled]="loading">{{ loading ? 'Checking...' : 'Check'
          }}</button>
        <button type="button" class="btn btn-secondary ms-2" (click)="onDownloadReport()" [disabled]="!results">Download
          Report</button>
      </div>
    </form>

    <div aria-live="polite" class="mt-3">
      <div *ngIf="loading" class="alert alert-info">Running checks — this can take 10–60 seconds.</div>
      <div *ngIf="message" class="alert alert-danger">{{ message }}</div>
    </div>

    <!-- Results -->
    <div *ngIf="results" class="mt-4" aria-live="polite">
      <h5>Results for {{ results.submittedBy.domain }}</h5>
      <div class="row">
        <div class="col-md-3">
          <div class="card p-2 mb-2">
            <h6>SSL</h6>
            <p>Status: {{ results.ssl?.status || 'N/A' }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-2 mb-2">
            <h6>Mozilla</h6>
            <p>Error: {{ results.mozilla?.error || 'N/A' }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-2 mb-2">
            <h6>W3C</h6>
            <p>URL: {{ results.w3c?.url || 'N/A' }}</p>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card p-2 mb-2">
            <h6>PageSpeed / PSI</h6>
            <p>Status: {{ results.pageSpeed?.lighthouseResult ? 'OK' : results.pageSpeed?.error || 'N/A' }}</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
